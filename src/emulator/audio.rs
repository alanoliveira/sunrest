#[derive(Clone, Copy, Debug, PartialEq, Eq)]
pub struct Signal {
    pub pulse1: u8,
    pub pulse2: u8,
    pub triangle: u8,
    pub noise: u8,
    pub dmc: u8,
}

impl Signal {
    pub fn sample(&self) -> f32 {
        let p1 = self.pulse1 as usize;
        let p2 = self.pulse2 as usize;
        let t = self.triangle as usize;
        let n = self.noise as usize;
        let d = self.dmc as usize;

        let pulse_sample = SQUARE_OUT[p1 + p2];
        let tnd_sample = TND_OUT[3 * t + 2 * n + d];

        pulse_sample + tnd_sample
    }
}

// [n] = 95.52 / (8128.0 / n + 100)
const SQUARE_OUT: [f32; 31] = [
    0.0,
    0.011_609_14,
    0.022_939_48,
    0.034_000_948,
    0.044_803,
    0.055_354_66,
    0.065_664_53,
    0.075_740_82,
    0.085_591_4,
    0.095_223_75,
    0.104_645_05,
    0.113_862_16,
    0.122_881_64,
    0.131_709_8,
    0.140_352_65,
    0.148_815_96,
    0.157_105_27,
    0.165_225_88,
    0.173_182_92,
    0.180_981_25,
    0.188_625_59,
    0.196_120_46,
    0.203_470_19,
    0.210_678_94,
    0.217_750_76,
    0.224_689_5,
    0.231_498_88,
    0.238_182_49,
    0.244_743_78,
    0.251_186_07,
    0.257_512_57,
];

// [n] = 163.67 / (24329.0 / n + 100)
const TND_OUT: [f32; 203] = [
    0.0,
    0.006_699_824,
    0.013_345_02,
    0.019_936_254,
    0.026_474_18,
    0.032_959_443,
    0.039_392_676,
    0.045_774_5,
    0.052_105_535,
    0.058_386_38,
    0.064_617_634,
    0.070_799_87,
    0.076_933_68,
    0.083_019_63,
    0.089_058_26,
    0.095_050_134,
    0.100_995_794,
    0.106_895_77,
    0.112_750_58,
    0.118_560_754,
    0.124_326_79,
    0.130_049_18,
    0.135_728_45,
    0.141_365_05,
    0.146_959_48,
    0.152_512_21,
    0.158_023_69,
    0.163_494_4,
    0.168_924_76,
    0.174_315_26,
    0.179_666_3,
    0.184_978_3,
    0.190_251_74,
    0.195_487,
    0.200_684_49,
    0.205_844_63,
    0.210_967_81,
    0.216_054_44,
    0.221_104_9,
    0.226_119_6,
    0.231_098_88,
    0.236_043_13,
    0.240_952_72,
    0.245_828,
    0.250_669_36,
    0.255_477_13,
    0.260_251_64,
    0.264_993_28,
    0.269_702_35,
    0.274_379_22,
    0.279_024_18,
    0.283_637_58,
    0.288_219_72,
    0.292_770_92,
    0.297_291_55,
    0.301_781_83,
    0.306_242_1,
    0.310_672_67,
    0.315_073_85,
    0.319_445_9,
    0.323_789_12,
    0.328_103_78,
    0.332_390_2,
    0.336_648_6,
    0.340_879_3,
    0.345_082_55,
    0.349_258_63,
    0.353_407_77,
    0.357_530_27,
    0.361_626_4,
    0.365_696_3,
    0.369_740_37,
    0.373_758_76,
    0.377_751_74,
    0.381_719_56,
    0.385_662_44,
    0.389_580_64,
    0.393_474_34,
    0.397_343_84,
    0.401_189_3,
    0.405_010_97,
    0.408_809_1,
    0.412_583_86,
    0.416_335_46,
    0.420_064_15,
    0.423_770_13,
    0.427_453_6,
    0.431_114_76,
    0.434_753_84,
    0.438_371,
    0.441_966_44,
    0.445_540_4,
    0.449_093,
    0.452_624_53,
    0.456_135_06,
    0.459_624_9,
    0.463_094_12,
    0.466_542_96,
    0.469_971_57,
    0.473_380_18,
    0.476_768_9,
    0.480_137_97,
    0.483_487_52,
    0.486_817_7,
    0.490_128_73,
    0.493_420_72,
    0.496_693_88,
    0.499_948_32,
    0.503_184_26,
    0.506_401_84,
    0.509_601_2,
    0.512_782_45,
    0.515_945_85,
    0.519_091_5,
    0.522_219_5,
    0.525_330_07,
    0.528_423_25,
    0.531_499_3,
    0.534_558_4,
    0.537_600_5,
    0.540_625_93,
    0.543_634_7,
    0.546_627_04,
    0.549_603_04,
    0.552_562_83,
    0.555_506_5,
    0.558_434_3,
    0.561_346_23,
    0.564_242_5,
    0.567_123_23,
    0.569_988_5,
    0.572_838_4,
    0.575_673_2,
    0.578_492_94,
    0.581_297_7,
    0.584_087_6,
    0.586_862_8,
    0.589_623_45,
    0.592_369_6,
    0.595_101_36,
    0.597_818_9,
    0.600_522_3,
    0.603_211_6,
    0.605_887_06,
    0.608_548_64,
    0.611_196_5,
    0.613_830_8,
    0.616_451_6,
    0.619_059,
    0.621_653_14,
    0.624_234,
    0.626_801_85,
    0.629_356_7,
    0.631_898_6,
    0.634_427_7,
    0.636_944_2,
    0.639_448_05,
    0.641_939_34,
    0.644_418_24,
    0.646_884_86,
    0.649_339_2,
    0.651_781_4,
    0.654_211_6,
    0.656_629_74,
    0.659_036_04,
    0.661_430_6,
    0.663_813_4,
    0.666_184_66,
    0.668_544_35,
    0.670_892_6,
    0.673_229_46,
    0.675_555_05,
    0.677_869_44,
    0.680_172_74,
    0.682_464_96,
    0.684_746_2,
    0.687_016_6,
    0.689_276_2,
    0.691_525_1,
    0.693_763_3,
    0.695_990_9,
    0.698_208_1,
    0.700_414_8,
    0.702_611_15,
    0.704_797_2,
    0.706_973_1,
    0.709_138_8,
    0.711_294_5,
    0.713_440_1,
    0.715_575_9,
    0.717_701_8,
    0.719_817_9,
    0.721_924_25,
    0.724_020_96,
    0.726_108_1,
    0.728_185_65,
    0.730_253_8,
    0.732_312_56,
    0.734_362,
    0.736_402_15,
    0.738_433_06,
    0.740_454_9,
    0.742_467_6,
];
